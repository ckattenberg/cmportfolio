---
title: "Comparing the songwriting styles of John Lennon and Paul McCartney"
author: "Céline"
date: "2/10/2021"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: "default"
    css: custom_theme.css
    favicon: images/favicon2_small.jpg
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include=FALSE}
library(tidyverse)
library(spotifyr)
library(plotly)
# Color Palettes
library(wesanderson)
library(compmus)
library(shiny)
library(gridExtra)
library(ggridges)
```


### Introduction Lennon-McCartney and Corpus

The Lennon-McCartney songwriting partnership was one of the most successful musical cooperations of all time. In the early days of the Beatles, John Lennon and Paul McCartney would often collaborate on songs extensively. As teenagers, they had made an agreement that they would both be credited with all songs written by either of them, whether jointly or separately. This is why all Beatles songs written by either Lennon or McCartney are officially credited to "Lennon-McCartney". Later on it became increasingly common for them to write songs separately. 

In an interview for Playboy Magazine in 1980, Lennon said the following about his songwriting partnership with McCartney:

> [Paul] provided a lightness, an optimism, while I would always go for the sadness, the discords, the bluesy notes. There was a period when I thought I didn't write melodies, that Paul wrote those and I just wrote straight, shouting rock 'n' roll. But, of course, when I think of some of my own songs—"In My Life", or some of the early stuff, "This Boy"—I was writing melody with the best of them.
  
I would be curious to see whether Lennon's characterization of the differences between his and McCartney's songwriting styles is accurate. The spotify API provides some features by which this potential difference could be explored. For example, the *valence* and *energy* features of the AudioFeaturesObject could be useful.

For this course, I will compare Beatles songs written (predominantly) by Paul McCartney to those written (predominantly) by John Lennon. To this end I created two playlists on Spotify. One playlist for the McCartney songs and one for the Lennon songs. I used the [this](http://www.myrsten.nu/worldnet/beatlesongs.htm) webpage as a guide to determine which song was written by whom. The corpus contains 142 songs in total (70 written by Paul McCartney and 72 written by John Lennon).

Paul McCartney once said about his songwriting relationship with John Lennon:

> He’d write ‘Strawberry Fields,’ I’d go away and write ‘Penny Lane’ … to compete with each other. But it was very friendly competition.

This seems to imply that the two songwriters influenced each other's writing to an extent. Therefore, I expect that the songs they wrote seperately during their time in the Beatles are probably more similar than the songs they wrote for their solo albums. To investigate this hypothesis, I will also use the first 2 solo albums by each artist to compare the differences in their early solo work to the differences in their writing styles when they were both in The Beatles.

First solo albums:

Paul McCartney:

- McCartney (1970)

- Ram (1971)

John Lennon:

- Plastic Ono Band (1970)

- Imagine (1971)


```{r echo = FALSE}
john_songs <- get_playlist_audio_features("", "6Wxl8tFi8QruTJ8ERPFkFc")
paul_songs <- get_playlist_audio_features("", "64vy4b9yg9tcvrf0a3XvdF")

george_songs <- get_playlist_audio_features("", "4DPiVpe75MnJkwNH31CBay")
ringo_songs <- get_playlist_audio_features("", "6Zhk7J5Ptorytp5HoFXNOc")

# First 3 non-beatles albums
paul_solo <- get_playlist_audio_features("", "6t8llLJqn3SZfMjbGCkK7K")
john_solo <- get_playlist_audio_features("", "1uqxGmA1qQNW7cWV4Tg49E")
george_solo <- get_playlist_audio_features("", "5mZmeueIrx62psQA24DUFG")

```

```{r echo = FALSE}
all_songs <- 
  bind_rows(
    john_songs %>% mutate(category = "John"),
    paul_songs %>% mutate(category = "Paul"),
    #george_songs %>% mutate(category = "George"),
    #ringo_songs %>% mutate(category = "Ringo")
  )

all_solo <-
  bind_rows(
    paul_solo %>% mutate(category = "Paul"),
    john_solo %>% mutate(category = "John"),
    #george_solo %>% mutate(category = "George")
  )

colors = c("#439AC8", "#F8D348")
```


### Valence VS Energy Beatles

```{r echo = FALSE}
ggplot_var <- ggplot(data = all_songs, mapping = aes(x = valence, y = energy, color = category)) + 
  geom_point(aes(size = track.duration_ms / 60, alpha = loudness, label = track.name)) +
  theme_light() + 
  geom_rug(size = 0.1) +   # Add 'fringes' to show data distribution.
  #scale_color_manual(values=colors) + 
  scale_size(range = c(-2, 6)) + 
  theme(legend.position="none") +
  labs(                            # Make the titles nice.
    x = "Valence",
    y = "Energy") +

  scale_x_continuous(              # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),        # Use grid-lines for quadrants only.
    minor_breaks = NULL            # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(              # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) +
  
  geom_text(                  # Add text labels from above.
    aes(
      x = valence,
      y = energy,
      label = label
    ),
    data = 
      tibble(
        label = c("Tomorrow Never Knows", "Back In The U.S.S.R.", "Julia"),
        category = c("John", "Paul", "John"),
        valence = c(0.0534, 0.494, 0.1930),
        energy = c(0.8290, 0.969, 0.0953)
      ),
    colour = "black",         # Override colour (not mode here).
    size = 2.5,              # Override size (not loudness here).
    hjust = "left",           # Align left side of label with the point.
    vjust = "bottom",         # Align bottom of label with the point.
    nudge_y = 0.03,         # Nudge the label slightly up.
    nudge_x = 0.05
  )

ggplotly(ggplot_var)

#ADD AVERAGE ON GRApH TO COMPARE! ADD THE THING ABOUT IRONIC
```

***

* The differences between the two Beatles' songwriting styles seems to be very small, at least in terms of valence and energy.
* The lowest valence songs are all written by John.
* Maybe the songwriting styles are similar because of the influence they had on each other. The friendly competition, as described in the introduction, may have been, in part, responsible for the distinctive "Beatles Sound".
* It does seem like almost all of the lowest energy songs were written by Paul, except for Julia, the lowest energy song in the entire dataset, which was written by John.
* I labelled three outliers in the dataset: *Tomorrow Never Knows* by John has a very low valence, and *Back In The USSR* has very high energy. *Julia* has very low energy and relatively long valence.


### Valence vs Energy Solo

```{r echo = FALSE}

viz1 <- ggplot(data = all_solo, mapping = aes(x = valence, y = energy, color = category)) + 
  geom_point(aes(size = track.duration_ms / 60, alpha = loudness, label = track.name)) +
  theme_light() + 
  geom_rug(size = 0.1) +
  theme(legend.position="none") +
  #scale_color_manual(values=colors) + 
  scale_size(range = c(-2, 6)) +
  #theme(legend.position="none")
  labs(                            # Make the titles nice.
    x = "Valence",
    y = "Energy") +

  scale_x_continuous(              # Fine-tune the x axis.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),        # Use grid-lines for quadrants only.
    minor_breaks = NULL            # Remove 'minor' grid-lines.
  ) +
  scale_y_continuous(              # Fine-tune the y axis in the same way.
    limits = c(0, 1),
    breaks = c(0, 0.50, 1),
    minor_breaks = NULL
  ) 

viz2 <- ggplot(data = all_solo) + 
  geom_point(mapping = aes(x = danceability, y = acousticness, color = category, size = track.duration_ms / 60, alpha = loudness, label = track.name)) +
  theme_classic() + 
  geom_rug() +
  #scale_color_manual(values=wes_palette(n=4, name="GrandBudapest1")) + 
  scale_size(range = c(-2, 6)) 
  #theme(legend.position="none")

ggplotly(viz1)
```

***

* We see more of a distinction in the solo albums.
* John's song noticeably have lower valence than Paul's, on average.
* John has many songs that are not very loud and have low valence and energy. As if he was taking a step back from the high energy, high valence Beatles sound.


### The Beatles sound: solo albums compared to Bleatles albums (NEW)

```{r echo = FALSE}
viz1 <- ggplot(all_solo, aes(x=danceability, fill=category)) +
  geom_density(alpha=0.7, color = NA)+
  labs(x="Danceability", y="Density") +
  theme_minimal()+
  ggtitle("Solo") +
  theme(legend.position="none") 


viz2 <- ggplot(all_songs, aes(x=danceability, fill=category)) +
  geom_density(alpha=0.6, color = NA)+
  labs(x="Danceability") +
  theme_minimal()+
  ggtitle("Beatles")+
  theme(axis.title.y=element_blank())

viz3 <- ggplot(all_solo, aes(x=valence, fill=category)) +
  geom_density(alpha=0.6, color = NA)+
  labs(x="Valence", y="Density") +
  scale_fill_manual(values=wes_palette(n = 2, name="GrandBudapest1")) +
  theme_minimal() +
  theme(legend.position="none") 


viz4 <- ggplot(all_songs, aes(x=valence, fill=category)) +
  geom_density(alpha=0.6, color = NA)+
  labs(x="Valence") +
  scale_fill_manual(values=wes_palette(n = 2, name="GrandBudapest1")) +
  theme_minimal() +
  theme(axis.title.y=element_blank())

viz5 <- ggplot(all_solo, aes(x=acousticness, fill=category)) +
  geom_density(alpha=0.6, color = NA)+
  labs(x="Acousticness", y="Density") +
  scale_fill_manual(values=wes_palette(n = 2, name="Darjeeling2")) +
  theme_minimal() +
  theme(legend.position="none") 


viz6 <- ggplot(all_songs, aes(x=acousticness, fill=category)) +
  geom_density(alpha=0.6, color = NA)+
  labs(x="Acousticness") +
  scale_fill_manual(values=wes_palette(n = 2, name="Darjeeling2")) +
  theme_minimal() +
  theme(axis.title.y=element_blank())

grid.arrange(viz1, viz2, viz3, viz4, viz5, viz6)

```

***

* The Beatles probability distributions for the different features overlap significantly more than the solo probability densities.
* This suggests that the writing styles of John and Paul were a lot more similar when they were in The Beatles together.
* They probably influenced each others writing.

### Valence Of Beatles Albums Over Time (NEW)

```{r echo = FALSE}
album_order <- rev(c("Please Please Me (Remastered)", "With The Beatles (Remastered)", "A Hard Day's Night (Remastered)", "Beatles For Sale (Remastered)", "Help! (Remastered)", "Rubber Soul (Remastered)", "Revolver (Remastered)", "Sgt. Pepper's Lonely Hearts Club Band (Remastered)", "Sgt. Pepper's Lonely Hearts Club Band (Super Deluxe Edition)", "Magical Mystery Tour (Remastered)", "The Beatles (Remastered)", "Yellow Submarine (Remastered)", "Abbey Road (Remastered)", "Let It Be (Remastered)"))
data1 <- filter(all_songs, track.album.release_date < 1973)

plot1 <- ggplot(data = data1, aes(x = valence, y = factor(track.album.name, level = album_order), fill =..x..)) + 
  geom_density_ridges_gradient(size = 0.1) + 
  scale_fill_gradient(low = "blue", high = "orange") + 
  theme_ridges() + 
  theme(panel.background = element_rect(fill = "white")) +
  theme(plot.background = element_rect(fill = "white")) +
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank()) + 
  theme(axis.text.y = element_text(size=5))+
  labs(x = "Valence")
  #+ theme(axis.text.y=element_blank())




plot1


```

***

* Early Beatles albums have higher valence than later Beatles albums.

### Valence Beatles Albums John vs Paul (NEW)

```{r echo=FALSE}
plot2 <- ggplot(data = data1, aes(x = valence, y = factor(track.album.name, level = album_order), fill =category)) + 
  geom_density_ridges(alpha = 0.9, size = 0.1) + 
  scale_fill_manual(values=colors) + 
  #scale_fill_gradient(low = "blue", high = "orange") + 
  theme_ridges() + 
  theme(panel.background = element_rect(fill = "white")) +
  theme(plot.background = element_rect(fill = "white")) +
  #theme(legend.position = "none") +
  theme(axis.title.y = element_blank()) + 
  theme(axis.text.y = element_text(size=5))
  #+ theme(axis.text.y=element_blank())

plot2
```

***

* In most of the early Beatles albums, Paul's songs had lower valence than John's and Paul seems to have more variation in valence.


### Chromagram John Lennon - Tomorrow Never Knows

```{r echo = FALSE}

tomorrow <-
  get_tidy_audio_analysis("00oZhqZIQfL9P5CjOP6JsO") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r echo = FALSE}
tomorrow %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

```

***

* This is a chromagram of the song **Tomorrow Never Knows**, written primarily by *John Lennon*. The song has an experimental and psychedelic sound. 
* The song lyrics are based on the book *The Psychedelic Experience: A Manual Based on The Tibetan Book of the Dead*. It was intended as a manual for people seeking spiritual enlightenment by using psychedelic drugs, such as LSD.
* The opening lyrics of the song:    

  Turn off your mind   
  Relax and float downstream    
  It is not dying     
        
  Are based on a line from the book: "Whenever in doubt, turn off your mind, relax, float downstream."

* According to the Spotify API, it is the song with the lowest valence of the entire dataset. 
* When I listen to it I notice that it is quite monotonous. However, I don't think it is necessarily a sad or angry song. 
* The chromagram indeed confirms that this song is quite monotonous: almost all of the sound falls into the C-tone bracket.
* John Lennon only used a single chord in the whole song. This creates a hypnotic sound.

### Chromagram Paul Mccartney - Ob-La-Di Ob-La- Da

```{r echo = FALSE}

obla <-
  get_tidy_audio_analysis("1gFNm7cXfG1vSMcxPpSxec") %>%
  select(segments) %>%
  unnest(segments) %>%
  select(start, duration, pitches)
```

```{r echo = FALSE}
obla %>%
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) %>%
  compmus_gather_chroma() %>% 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()

```

### What is the structure of 'Hey Jude’ (chroma and timbre features)

```{r echo = FALSE}
because <-
  
  get_tidy_audio_analysis("1rxoyGj1QuPoVi8fOft1Kt") %>%
  #0aym2LBJBk9DAYuHHutrIl
  compmus_align(bars, segments) %>%
  select(bars) %>%
  unnest(bars) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "acentre", norm = "manhattan"
      )
  ) %>%
  mutate(
    timbre =
      map(segments,
        compmus_summarise, timbre,
        method = "mean"
      )
  )
bind_rows(
  because %>% 
    compmus_self_similarity(pitches, "aitchison") %>% 
    mutate(d = d / max(d), type = "Chroma"),
  because %>% 
    compmus_self_similarity(timbre, "euclidean") %>% 
    mutate(d = d / max(d), type = "Timbre")
) %>%
  mutate() %>% 
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_fixed() +
  facet_wrap(~type) +
  scale_fill_viridis_c() +
  theme_minimal() + 
  labs(x = "", y = "")
```

***

These two self-similarity matrices illustrate pitch and timbre based self similarity in the song "Because" written by John Lennon.



### Chordograms (NEW)

```{r echo = FALSE}
circshift <- function(v, n) {
  if (n == 0) v else c(tail(v, n), head(v, -n))
}

#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )
```

```{r echo = FALSE}
albert <-
  get_tidy_audio_analysis("5SwgE4wA0P7f6AEz2UQMB2") %>%
  compmus_align(sections, segments) %>%
  select(sections) %>%
  unnest(sections) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "mean", norm = "manhattan"
      )
  )

martha <- get_tidy_audio_analysis("1swmf4hFMJYRNA8Rq9PVaW") %>%
  compmus_align(sections, segments) %>%
  select(sections) %>%
  unnest(sections) %>%
  mutate(
    pitches =
      map(segments,
        compmus_summarise, pitches,
        method = "mean", norm = "manhattan"
      )
  )

```

```{r echo = FALSE}
albert %>% 
  compmus_match_pitch_template(
    key_templates,         # Change to chord_templates if descired
    method = "euclidean",  # Try different distance metrics
    norm = "manhattan"     # Try different norms
  ) %>%
  ggplot(
    aes(x = start + duration / 2, width = duration, y = name, fill = d)
  ) +
  geom_tile() +
  scale_fill_viridis_c(guide = "none") +
  theme_minimal() +
  labs(x = "Time (s)", y = "")


```

***

* Uncle Albert/Admiral Halsey is a song by Paul McCartney from his solo album Ram, with a very interesting structure.
* The different sections of the song are clearly visible in the keygram.
* You can see that some parts of the song are repeated several times.


### Discussion





